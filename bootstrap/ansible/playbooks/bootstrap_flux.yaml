- name: Bootstrap Flux
  hosts: server[0]
  become: false
  gather_facts: false
  tasks:
    - name: Include all default extension files in vars/all and all nested directories and save the output in test. (2.2)
      ansible.builtin.include_vars:
        dir: "{{ project_path }}/bootstrap/ansible/group_vars"

    - name: Bootstrap Flux
      become: false
      delegate_to: localhost
      shell:
        cmd: >
          echo {{ github_token }} |
          flux bootstrap github
          --token-auth --owner="{{ github_user }}"
          --repository="{{ github_repo }}"
          --branch="{{ github_branch }}"
          --path="{{ github_path }}"
          --personal
          --force
          --private=true
          --network-policy=false

# - hosts: server
#   tasks:
#   - name: Delete remote directory "old_files" from Git repository
#     delegate_to: localhost
#     git:
#       repo: "https://github.com/andyopengit/home_sys.git"
#       dest: "{{ project_path }}"
#       force: true
#       state: absent
#       path: "kubernetes/flux-system"
  
      # working command from commmand line
      # flux bootstrap github --token-auth --owner=andyopengit --repository=home_sys --branch=master --personal --path=kubernetes --private=true --force --log-level=debug --network-policy=false
  # tasks:
  #   - block:
  #     - command:
  #         # cmd: 'echo $GITHUB_TOKEN'
  #         cmd: flux bootstrap github --token-auth --owner="{{ github_user }}" --repository="{{ github_repo }}" --branch="{{ github_branch }}" --path="{{ github_path }}" --personal --force
  #       register: result
  #     - debug:
  #         var: result.stdout
    # environment:
    #   GITHUB_TOKEN: "{{ github_token }}"
