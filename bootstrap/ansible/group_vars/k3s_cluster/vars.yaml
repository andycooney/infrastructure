k3s_version: v1.32.1+k3s1
github_token: "{{ lookup('community.general.onepassword', 'cloudflare_token', vault='kubernetes') }}"
github_user: 'andyopengit'
github_repo: 'home_sys'
github_branch: 'master'
github_path: 'kubernetes'
onepass_credentials: "{{ lookup('community.general.onepassword_doc', 'onepass_credentials', vault='kubernetes')  | b64encode }}"
onepass_token: "{{ lookup('community.general.onepassword', 'onepass_token', vault='kubernetes') | b64encode }}"
token: "{{ lookup('community.general.onepassword', vault='kubernetes', 'k3s_token') }}"
k3s_kubectl_binary: "kubectl"
k3s_master_taint: "{{ true if groups['agent'] | default([]) | length >= 1 else false }}"
api_endpoint: "{{ hostvars[groups['server'][0]]['ansible_host'] | default(groups['server'][0]) }}"
extra_server_args: >-
  --node-taint node.cilium.io/agent-not-ready:NoExecute
  {{ '--node-taint node-role.kubernetes.io/master=true:NoSchedule' if k3s_master_taint else '' }}
  --kubelet-arg node-status-update-frequency=5s
  --tls-san {{ api_endpoint }},kube.cooney.site,kube01.cooney.site
  --flannel-backend=none
  --disable-kube-proxy
  --disable-network-policy
  --disable=servicelb
  --disable traefik
extra_agent_args:
  --kubelet-arg node-status-update-frequency=5s
systemd_dir: /etc/systemd/system
